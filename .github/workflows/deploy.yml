name: Deploy to VPS

on:
  push:
    branches:
      - main # Apni branch ka naam 'main' ya 'master' daalein

jobs:
  deploy:
    # Sabse zaroori: Yeh job aapke VPS par chalegi
    runs-on: self-hosted

    steps:
      - name: 1. Code Checkout
        uses: actions/checkout@v4

      # --- YEH STEP ADD KAREIN ---
      - name: 2. Stop and Remove Old Containers
        run: docker compose down
      # --------------------------

      - name: 3. Build and Start New Containers
        # Step 2 ka naam badal kar 3 kar diya hai
        run: docker compose up --build -d --remove-orphans
        
      - name: 4. Clean Up Old Images
        # Step 3 ka naam badal kar 4 kar diya hai
        run: docker image prune -f
